<?php if (!defined('ABSPATH')) { exit; }
class Compu_Stage_Fetch { public function run($args){ $file=$args['file'] ?? COMPU_IMPORT_DEFAULT_CSV; if(!file_exists($file)){ \WP_CLI::error("No encuentro el archivo: {$file}"); } $run_id=compu_import_run_open($args['source'] ?? 'syscom',$file); $base=compu_import_get_base_dir(); $dir=trailingslashit($base).'run-'.$run_id; compu_import_mkdir($dir); $dest=trailingslashit($dir).'source.csv'; copy($file,$dest); compu_import_log($run_id,'fetch','info','Archivo copiado',['src'=>$file,'dest'=>$dest]); \WP_CLI::success("Run {$run_id} inicializado. Fuente copiada a {$dest}"); } }