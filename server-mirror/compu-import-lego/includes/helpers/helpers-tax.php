<?php
if (!defined('ABSPATH')) { exit; }
function compu_ensure_term($taxonomy,$name,$parent=0){ $name=trim($name); if($name==='') return [0,new WP_Error('empty','Nombre vacÃ­o')]; $term=term_exists($name,$taxonomy,$parent); if($term===0 || $term===null){ $slug=compu_import_slug($name); $term=wp_insert_term($name,$taxonomy,['slug'=>$slug,'parent'=>$parent]); } if(is_wp_error($term)) return [0,$term]; $id=is_array($term)?$term['term_id']:(int)$term; return [$id,null]; }
function compu_assign_product_terms($post_id,$brand_name,$cats){ if($brand_name && taxonomy_exists('product_brand')){ list($bid,$e)=compu_ensure_term('product_brand',$brand_name); if(!$e && $bid){ wp_set_object_terms($post_id,[$bid],'product_brand',false);} } $parent=0; $assigned=[]; foreach($cats as $n){ if(!$n) continue; list($tid,$e)=compu_ensure_term('product_cat',$n,$parent); if(!$e && $tid){ $parent=$tid; $assigned[]=$tid; } } if($assigned){ wp_set_object_terms($post_id,$assigned,'product_cat',false);} }
